<div *ngIf="loading" class="flex justify-center items-center h-64">
  <p-progressSpinner></p-progressSpinner>
</div>

<div *ngIf="!loading && order" class="space-y-8 p-6 bg-gray-50 min-h-screen">
  <div class="flex items-center justify-between">
    <h2 class="text-2xl font-semibold text-gray-800">
      ğŸ§¾ Detalle de la Orden #{{ order.id }}
    </h2>
    <p-button
      routerLink="/admin/orders"
      label="â† Volver al listado"
      severity="info"
    />
  </div>

  <p-card class="shadow-md rounded-2xl border border-gray-200">
    <div class="grid md:grid-cols-2 gap-6">
      <div class="space-y-2">
        <p><strong>ğŸ‘¤ Cliente:</strong> {{ order.customerName }}</p>
        <p>
          <strong>ğŸ‘¨â€ğŸ³ Empleado:</strong>
          {{ order.employeeName || "No asignado" }}
        </p>
        <p><strong>ğŸ“¦ Tipo de orden:</strong> {{ order.typeName }}</p>
        <p><strong>ğŸ“… Fecha:</strong> {{ order.date | date : "medium" }}</p>
        <p>
          <strong>ğŸ’° Total:</strong>
          <span class="text-green-600 font-semibold text-lg">
            S/ {{ order.total | number : "1.2-2" }}
          </span>
        </p>
      </div>

      <div class="space-y-2">
        <p><strong>ğŸª‘ Mesa:</strong> {{ order.tableCode || "N/A" }}</p>
        <p><strong>ğŸ¬ Tienda:</strong> {{ order.pickupStoreName || "N/A" }}</p>
        <p>
          <strong>ğŸ“ DirecciÃ³n Tienda:</strong>
          {{ order.pickupStoreAddress || "N/A" }}
        </p>
        <p><strong>â± Tiempo estimado:</strong> {{ order.estimatedTime }} min</p>
        <p>
          <strong>ğŸš— Distancia estimada:</strong> {{ order.estimatedDistance }}
        </p>
        <p>
          <strong>âŒ› DuraciÃ³n estimada:</strong> {{ order.estimatedDuration }}
        </p>
      </div>
    </div>
  </p-card>

  <p-card
    header="ğŸšš InformaciÃ³n de Entrega"
    *ngIf="order.typeName === 'Entrega a domicilio'"
    class="shadow-md rounded-2xl border border-gray-200"
  >
    <div class="grid md:grid-cols-2 gap-6">
      <div class="space-y-2">
        <p><strong>Calle:</strong> {{ order.deliveryStreet }}</p>
        <p>
          <strong>Referencia:</strong>
          {{ order.deliveryReference || "Ninguna" }}
        </p>
        <p>
          <strong>Instrucciones:</strong>
          {{ order.deliveryInstructions || "Ninguna" }}
        </p>
      </div>

      <div class="space-y-2">
        <p><strong>Ciudad:</strong> {{ order.deliveryCity }}</p>
        <p><strong>Provincia:</strong> {{ order.deliveryProvince }}</p>
        <p><strong>CÃ³digo Postal:</strong> {{ order.deliveryZipCode }}</p>
      </div>
    </div>

    <div class="mt-6">
      <p class="font-semibold mb-2 text-gray-700">ğŸ“ UbicaciÃ³n del Cliente</p>

      <img
        *ngIf="order.deliveryLatitude && order.deliveryLongitude"
        class="w-full h-72 rounded-xl shadow-sm border border-gray-200"
        [src]="
          'https://maps.googleapis.com/maps/api/staticmap?center=' +
          order.deliveryLatitude +
          ',' +
          order.deliveryLongitude +
          '&zoom=15&size=600x300&markers=color:red%7C' +
          order.deliveryLatitude +
          ',' +
          order.deliveryLongitude +
          '&key=' +
          googleMapsKey
        "
        alt="Mapa de ubicaciÃ³n"
      />

      <p class="text-gray-500 text-sm mt-2">
        Latitud: {{ order.deliveryLatitude }} | Longitud:
        {{ order.deliveryLongitude }}
      </p>
    </div>
  </p-card>

  <p-card
    header="ğŸ§¾ Detalles de Productos"
    class="shadow-md rounded-2xl border border-gray-200"
  >
    <p-table
      [value]="order.details"
      styleClass="p-datatable-sm"
      responsiveLayout="scroll"
    >
      <ng-template pTemplate="header">
        <tr>
          <th class="w-1/2">Producto</th>
          <th class="text-center">Cantidad</th>
          <th class="text-center">Precio Unitario</th>
          <th class="text-center">Subtotal</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-detail>
        <tr>
          <td>{{ detail.productName }}</td>
          <td class="text-center">{{ detail.quantity }}</td>
          <td class="text-center">
            S/ {{ detail.unitPrice | number : "1.2-2" }}
          </td>
          <td class="text-center font-semibold">
            S/ {{ detail.unitPrice * detail.quantity | number : "1.2-2" }}
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<div *ngIf="!loading && !order" class="text-center text-gray-500 mt-10">
  <p>No se encontrÃ³ la orden solicitada.</p>
</div>
