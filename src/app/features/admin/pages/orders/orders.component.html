<div class="p-6">
  <h2 class="text-2xl font-bold mb-4">üì¶ Gesti√≥n de √ìrdenes</h2>

  @if (orders.length === 0) {
  <div
    class="flex flex-col items-center justify-center bg-gray-50 border border-dashed border-gray-300 rounded-lg p-10 text-center shadow-sm"
  >
    <i class="pi pi-inbox text-6xl text-gray-400 mb-4"></i>
    <h3 class="text-lg font-semibold text-gray-700">
      No tienes √≥rdenes registradas
    </h3>
    <p class="text-gray-500 mt-1 mb-4">
      Cuando recibas nuevas √≥rdenes aparecer√°n aqu√≠.
    </p>
    <button
      pButton
      type="button"
      icon="pi pi-refresh"
      label="Actualizar"
      class="p-button-outlined p-button-sm"
      (click)="loadOrders()"
    ></button>
  </div>
  } @else {
  <p-table [value]="orders" class="shadow-lg rounded-lg overflow-hidden">
    <ng-template pTemplate="header">
      <tr>
        <th class="text-left"># Orden</th>
        <th class="text-left">Cliente</th>
        <th class="text-left">Direcci√≥n</th>
        <th class="text-left">Fecha</th>
        <th class="text-right">Total</th>
        <th class="text-center">Estado</th>
        <th class="text-center">Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body">
      @for (order of orders; track order.id) {
      <tr>
        <td>{{ order.id }}</td>
        <td>{{ order.customerName }}</td>
        <td>{{ order.addressDescription }}</td>
        <td>{{ order.date | date : "short" }}</td>
        <td class="text-right">S/. {{ order.total | number : "1.2-2" }}</td>
        <td class="text-center">
          <p-tag [value]="order.statusName" />
        </td>
        <td class="text-center space-x-2">
          <p-button
            type="button"
            icon="pi pi-search"
            size="small"
            pTooltip="Ver detalle"
            [rounded]="true"
            [raised]="true"
            severity="info"
          ></p-button>

          <p-button
            type="button"
            icon="pi pi-times"
            size="small"
            pTooltip="Cancelar orden"
            [raised]="true"
            [rounded]="true"
            severity="danger"
            [disabled]="
              order.statusName === 'DELIVERED' ||
              order.statusName === 'CANCELLED'
            "
          ></p-button>
        </td>
      </tr>
      }
    </ng-template>
  </p-table>
  }

  <div class="mt-10">
    <h3 class="text-xl font-semibold mb-6">üçΩÔ∏è Vista de Mesas</h3>

    <div
      class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6"
    >
      <div
        *ngFor="let table of tables"
        class="p-6 rounded-xl shadow-md flex flex-col items-center justify-center cursor-pointer"
        [ngClass]="{
          'bg-green-100 border border-green-400': table.status === 'FREE',
          'bg-yellow-100 border border-yellow-400': table.status === 'OCCUPIED',
          'bg-red-100 border border-red-400': table.status === 'OUT_OF_SERVICE'
        }"
        (click)="openTableActions(table)"
      >
        <i class="pi pi-table text-3xl mb-2"></i>
        <span class="font-semibold">Mesa {{ table.code }}</span>
        <small class="text-gray-700">{{ table.status }}</small>
      </div>

      <p-dialog
        header="Modificar Mesa"
        [modal]="true"
        [(visible)]="dialogTableVisible"
        [style]="{ width: '40rem', height: 'auto', 'max-height': '90vh' }"
        [contentStyle]="{ 'overflow-y': 'auto' }"
      >
        <span class="p-text-secondary block mb-6">
          Actualiza la informaci√≥n de la mesa seleccionada
        </span>

        <div class="flex flex-col space-y-4">
          <div class="flex flex-col gap-4 mb-4">
            <label for="name" class="font-semibold w-32">Codigo</label>
            <input
              pInputText
              id="name"
              class="flex-auto"
              [(ngModel)]="selectedTable.code"
              autocomplete="off"
            />
          </div>

          <div class="flex flex-col gap-4 mb-4">
            <label>Capacidad</label>
            <p-floatlabel>
              <p-inputnumber
                id="capacity"
                [showButtons]="true"
                buttonLayout="horizontal"
                spinnerMode="horizontal"
                class="w-full"
                [(ngModel)]="selectedTable.capacity"
              >
                <ng-template #incrementbuttonicon>
                  <span class="pi pi-plus"></span>
                </ng-template>
                <ng-template #decrementbuttonicon>
                  <span class="pi pi-minus"></span>
                </ng-template>
              </p-inputnumber>
            </p-floatlabel>
          </div>

          <div class="flex flex-col gap-4 mb-4">
            <label for="status" class="font-semibold w-32">Estado</label>
            <p-autocomplete
              id="status"
              [suggestions]="filteredStatusOptions"
              [(ngModel)]="selectedTable.status"
              (completeMethod)="searchTableState($event)"
              [dropdown]="true"
              appendTo="body"
              styleClass="w-full"
            />
          </div>

          <div class="flex justify-end gap-2">
            <p-button
              label="Cancelar"
              severity="secondary"
              (click)="dialogTableVisible = false"
            />
            <p-button label="Guardar" (click)="saveTable()" />
          </div>
        </div>
      </p-dialog>
    </div>
  </div>
</div>
