<div class="p-6">
  <div class="bg-white rounded-lg shadow-md overflow-hidden">
    <!-- Cabecera -->
    <div class="p-6 border-b">
      <h2 class="text-2xl font-bold text-gray-800">Historial de Cierres de Caja</h2>
      <p class="text-gray-500">
        Revisa todos los cierres de caja realizados por el personal.
      </p>
    </div>

    <!-- Spinner de Carga -->
    <div *ngIf="isLoading()" class="flex justify-center items-center h-64">
      <p-progressSpinner
        animationDuration=".5s"
        strokeWidth="4"
      ></p-progressSpinner>
    </div>

    <!-- Tabla de Historial -->
    <div *ngIf="!isLoading()">
      <p-table
        [value]="sessions()"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[10, 25, 50]"
        [tableStyle]="{ 'min-width': '50rem' }"
        styleClass="p-datatable-striped"
      >
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="closingTime">
              Fecha y Hora <p-sortIcon field="closingTime"></p-sortIcon>
            </th>
            <th pSortableColumn="employeeName">
              Cajero <p-sortIcon field="employeeName"></p-sortIcon>
            </th>
            <th pSortableColumn="expectedCash" class="text-right">
              Efectivo Esperado <p-sortIcon field="expectedCash"></p-sortIcon>
            </th>
            <th pSortableColumn="countedCash" class="text-right">
              Efectivo Contado <p-sortIcon field="countedCash"></p-sortIcon>
            </th>
            <th pSortableColumn="difference" class="text-center">
              Diferencia <p-sortIcon field="difference"></p-sortIcon>
            </th>
            <th>Notas</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-session>
          <tr>
            <td>{{ session.closingTime | date : 'dd/MM/yy, h:mm a' }}</td>
            <td>{{ session.employeeName }}</td>
            <td class="text-right">
              {{ session.expectedCash | currency : 'S/ ' }}
            </td>
            <td class="text-right">
              {{ session.countedCash | currency : 'S/ ' }}
            </td>
            <td class="text-center">
              <p-tag
                [severity]="getDifferenceSeverity(session.difference)"
                [value]="getDifferenceLabel(session.difference)"
              ></p-tag>
              <span
                class="ml-2 font-semibold"
                [ngClass]="{
                  'text-green-600': session.difference > 0,
                  'text-red-600': session.difference < 0,
                  'text-gray-700': session.difference === 0
                }"
              >
                ({{ session.difference | currency : 'S/ ' }})
              </span>
            </td>
            <td>
              <i
                *ngIf="session.notes"
                class="pi pi-comment text-gray-500"
                [pTooltip]="session.notes"
                tooltipPosition="top"
              ></i>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="6" class="text-center p-4">
              No se encontraron cierres de caja.
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>