<div class="p-4 sm:p-6 space-y-6">
  <header
    class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"
  >
    <div>
      <h2 class="text-2xl sm:text-3xl font-bold text-gray-800">
        ðŸ“… Reservaciones
      </h2>
      <p class="text-gray-500 mt-1">
        Gestiona las reservas de mesas del restaurante.
      </p>
    </div>
    <!-- âœ… BotÃ³n para ir a la pÃ¡gina de creaciÃ³n -->
    <p-button
      label="Nueva Reserva"
      icon="pi pi-plus"
      (onClick)="goToCreateReservation()"
    ></p-button>
  </header>

  <div class="grid lg:grid-cols-3 gap-6">
    <!-- CALENDARIO VISUAL (sin cambios funcionales, quizÃ¡s ajustar estilos) -->
    <div class="lg:col-span-2 border rounded-xl p-4 shadow-sm bg-white">
      <div class="flex justify-between items-center mb-4">
        <!-- ... botones de navegaciÃ³n mes/aÃ±o ... -->
        <span class="font-semibold text-lg">{{
          currentMonth | date : "MMMM yyyy" : "" : "es-PE"
        }}</span>
        <!-- ... botones de navegaciÃ³n mes/aÃ±o ... -->
      </div>
      <div
        class="grid grid-cols-7 text-center font-medium text-gray-500 text-sm mb-2"
      >
        <div
          *ngFor="let day of ['Dom', 'Lun', 'Mar', 'MiÃ©', 'Jue', 'Vie', 'SÃ¡b']"
        >
          {{ day }}
        </div>
      </div>
      <div class="grid grid-cols-7 gap-1">
        <div
          *ngFor="let day of getDaysOfMonth()"
          class="p-2 border rounded-md cursor-pointer aspect-square flex flex-col items-center justify-center text-center relative hover:bg-blue-50 transition-colors duration-150"
          [ngClass]="{
            'bg-blue-500 text-white font-bold cursor-pointer hover:bg-blue-600':
              selectedDate?.toDateString() === day?.toDateString(),

            'bg-white text-gray-700 font-medium cursor-pointer hover:bg-blue-50':
              day && selectedDate?.toDateString() !== day?.toDateString(),

            'bg-gray-50 text-gray-300 cursor-default pointer-events-none': !day
          }"
          (click)="selectDate(day)"
        >
          <span *ngIf="day">{{ day.getDate() }}</span>
          <!-- Indicador de reserva (punto) -->
          <span
            *ngIf="hasReservation(day)"
            class="absolute bottom-1 left-1/2 transform -translate-x-1/2 w-1.5 h-1.5 bg-red-500 rounded-full"
          ></span>
        </div>
      </div>
    </div>

    <!-- âŒ SECCIÃ“N DEL FORMULARIO ELIMINADA -->
    <!-- <div class="lg:col-span-1 ..."> ... </div> -->

    <!-- âœ… NUEVO ESPACIO o componente para mostrar detalles del dÃ­a seleccionado -->
    <div
      class="lg:col-span-1 border rounded-xl p-4 shadow-sm bg-white flex flex-col"
    >
      <h3 class="font-semibold mb-3 text-gray-700">
        {{
          selectedDate
            ? (selectedDate | date : "EEEE, d MMMM" : "" : "es-PE")
            : "Selecciona un dÃ­a"
        }}
      </h3>
      <div class="flex-grow overflow-y-auto space-y-3">
        <p *ngIf="!selectedDate" class="text-gray-400 text-center mt-8">
          Haz clic en un dÃ­a del calendario para ver las reservas.
        </p>
        <p
          *ngIf="selectedDate && filteredReservations.length === 0"
          class="text-gray-400 text-center mt-8"
        >
          No hay reservas para este dÃ­a.
        </p>

        <!-- Mini lista de reservas del dÃ­a seleccionado -->
        <div
          *ngFor="let res of filteredReservations"
          class="p-3 rounded-lg border flex justify-between items-center cursor-pointer hover:bg-gray-50"
          (click)="viewReservationDetail(res.id)"
        >
          <div>
            <p class="font-medium text-sm text-gray-800">
              {{ res.customerName || res.contactName }}
            </p>
            <p class="text-xs text-gray-500">
              {{ res.reservationTime | slice : 0 : 5 }} -
              {{ res.numberOfPeople }} pers.
            </p>
          </div>
          <p-tag
            [value]="res.status"
            [severity]="getStatusSeverity(res.status)"
            [rounded]="true"
            styleClass="text-xs"
          ></p-tag>
        </div>
      </div>
    </div>
  </div>

  <!-- FILTRO POR RANGO Y TABLA PRINCIPAL -->
  <div class="mt-6 border rounded-xl p-4 shadow-sm bg-white">
    <div
      class="mb-4 flex flex-col sm:flex-row items-start sm:items-center gap-3"
    >
      <label class="font-medium text-gray-700 whitespace-nowrap"
        >Filtrar por rango:</label
      >
      <!-- âœ… Usamos p-calendar para seleccionar rango -->
      <p-calendar
        [(ngModel)]="dateRange"
        selectionMode="range"
        [readonlyInput]="true"
        dateFormat="dd/mm/yy"
        (onSelect)="applyFilters()"
        placeholder="Selecciona un rango"
        [showIcon]="true"
      >
      </p-calendar>
      <p-button
        label="Limpiar"
        [outlined]="true"
        severity="secondary"
        icon="pi pi-times"
        (click)="clearFilters()"
        [disabled]="!dateRange && !selectedDate"
      ></p-button>
    </div>

    <p-table
      [value]="filteredReservations"
      styleClass="p-datatable-striped p-datatable-sm"
      [tableStyle]="{ 'min-width': '50rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="id">#</th>
          <th pSortableColumn="customerName">Cliente/Contacto</th>
          <th pSortableColumn="reservationDate">Fecha</th>
          <th pSortableColumn="reservationTime">Hora</th>
          <th pSortableColumn="numberOfPeople">Personas</th>
          <th pSortableColumn="tableNumber">Mesa</th>
          <th pSortableColumn="status">Estado</th>
          <th>Acciones</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-res>
        <tr class="hover:bg-gray-50">
          <td>{{ res.id }}</td>
          <td>{{ res.customerName || res.contactName }}</td>
          <td>{{ res.reservationDate | date : "dd/MM/yy" }}</td>
          <td>{{ res.reservationTime | slice : 0 : 5 }}</td>
          <!-- Mostramos solo HH:mm -->
          <td>{{ res.numberOfPeople }}</td>
          <td>{{ res.tableNumber || "N/A" }}</td>
          <!-- Muestra cÃ³digo de mesa si viene -->
          <td>
            <p-tag
              [value]="res.status"
              [severity]="getStatusSeverity(res.status)"
              [rounded]="true"
            ></p-tag>
          </td>
          <td>
            <p-button
              icon="pi pi-eye"
              [text]="true"
              [rounded]="true"
              pTooltip="Ver Detalle"
              (click)="viewReservationDetail(res.id)"
            ></p-button>
            <!-- PodrÃ­as aÃ±adir botÃ³n de editar aquÃ­ -->
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8" class="text-center p-4">
            No se encontraron reservaciones con los filtros aplicados.
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
