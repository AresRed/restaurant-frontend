<div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-7xl mx-auto mt-40">
  <!-- Columna izquierda (Stepper Content) -->
  <div class="md:col-span-2 bg-white p-6 rounded-2xl shadow-lg space-y-6">
    <h2 class="text-2xl font-bold text-gray-800 text-center">
      Opciones de Compra
    </h2>

    <p-stepper [value]="1" styleClass="w-full">
      <p-step-list>
        <p-step [value]="1" icon="pi pi-truck">Tipo de Entrega</p-step>
        <p-step [value]="2" icon="pi pi-map-marker">Dirección de Envío</p-step>
        <p-step [value]="3" icon="pi pi-credit-card">Método de Pago</p-step>
      </p-step-list>

      <p-step-panels>
        <p-step-panel [value]="1">
          <ng-template #content let-activateCallback="activateCallback">
            <div class="flex flex-col space-y-4">
              <label
                class="flex items-center gap-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer transition"
              >
                <p-radiobutton
                  name="shipping"
                  value="pickup-delivery"
                  [(ngModel)]="shippingOption"
                />
                <i class="pi pi-truck text-blue-500 text-lg"></i>
                <span class="text-gray-800">Delivery a domicilio</span>
              </label>

              <label
                class="flex items-center gap-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer transition"
              >
                <p-radiobutton
                  name="shipping"
                  value="pickup-store"
                  [(ngModel)]="shippingOption"
                />
                <i class="pi pi-shop text-green-500 text-lg"></i>
                <span class="text-gray-800">Recojo en tienda/local</span>
              </label>

              <label
                class="flex items-center gap-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer transition"
              >
                <p-radiobutton
                  name="shipping"
                  value="pickup-agency"
                  [(ngModel)]="shippingOption"
                />
                <i class="pi pi-map-marker text-red-500 text-lg"></i>
                <span class="text-gray-800">Recojo en agencia o locker</span>
              </label>
            </div>
            <div class="flex justify-end mt-6">
              <p-button
                label="Siguiente"
                size="small"
                icon="pi pi-arrow-right"
                (click)="activateCallback(2)"
              ></p-button>
            </div>
          </ng-template>
        </p-step-panel>

        <p-step-panel [value]="2">
          <ng-template #content let-activateCallback="activateCallback">
            <div class="space-y-6">
              <div
                *ngIf="shippingOption === 'pickup-delivery'"
                class="grid grid-cols-1 md:grid-cols-2 gap-4"
              >
                <input
                  type="text"
                  placeholder="Calle y número"
                  class="p-inputtext p-component w-full"
                  [(ngModel)]="address.street"
                />
                <input
                  type="text"
                  placeholder="Ciudad"
                  class="p-inputtext p-component w-full"
                  [(ngModel)]="address.city"
                />
                <input
                  type="text"
                  placeholder="Provincia"
                  class="p-inputtext p-component w-full"
                  [(ngModel)]="address.province"
                />
                <input
                  type="text"
                  placeholder="Código postal"
                  class="p-inputtext p-component w-full"
                  [(ngModel)]="address.zip"
                />
                <input
                  type="text"
                  placeholder="Referencia (opcional)"
                  class="p-inputtext p-component w-full col-span-2"
                  [(ngModel)]="address.reference"
                />
                <input
                  type="text"
                  placeholder="Nombre de quien recibe"
                  class="p-inputtext p-component w-full"
                  [(ngModel)]="address.receiver"
                />
                <input
                  type="tel"
                  placeholder="Teléfono de contacto"
                  class="p-inputtext p-component w-full"
                  [(ngModel)]="address.phone"
                />
              </div>

              <div
                *ngIf="shippingOption === 'pickup-store'"
                class="flex flex-col space-y-4"
              >
                <p-autoComplete
                  [(ngModel)]="storeSelected"
                  [suggestions]="filteredStores"
                  (completeMethod)="searchStores($event)"
                  optionLabel="name"
                  [readonly]="true"
                  [dropdown]="true"
                  styleClass="w-full"
                  placeholder="Buscar tienda..."
                />
                <input
                  type="text"
                  pInputText
                  placeholder="Nombre de quien retira"
                  class="p-component w-full"
                  [(ngModel)]="address.receiver"
                />
                <input
                  type="tel"
                  placeholder="Teléfono de contacto"
                  class="p-inputtext p-component w-full"
                  [(ngModel)]="address.phone"
                />
                <input
                  type="text"
                  placeholder="Documento de identidad"
                  class="p-inputtext p-component w-full"
                  [(ngModel)]="address.document"
                />
              </div>

              <div
                *ngIf="shippingOption === 'pickup-agency'"
                class="flex flex-col space-y-4"
              >
                <p-autoComplete
                  [(ngModel)]="agencySelected"
                  [suggestions]="filteredAgencies"
                  (completeMethod)="searchAgencies($event)"
                  optionLabel="name"
                  [readonly]="true"
                  [dropdown]="true"
                  styleClass="w-full"
                  placeholder="Buscar agencia..."
                  class="w-full"
                />
                <input
                  type="text"
                  placeholder="Nombre de quien retira"
                  class="p-inputtext p-component w-full"
                  [(ngModel)]="address.receiver"
                />
                <input
                  type="tel"
                  placeholder="Teléfono de contacto"
                  class="p-inputtext p-component w-full"
                  [(ngModel)]="address.phone"
                />
                <input
                  type="text"
                  placeholder="Documento de identidad"
                  class="p-inputtext p-component w-full"
                  [(ngModel)]="address.document"
                />
              </div>
            </div>
            <div class="flex pt-6 justify-between">
              <p-button
                label="Volver"
                severity="secondary"
                icon="pi pi-arrow-left"
                (onClick)="activateCallback(1)"
              />
              <p-button
                label="Siguiente"
                icon="pi pi-arrow-right"
                iconPos="right"
                (onClick)="activateCallback(3)"
              />
            </div>
          </ng-template>
        </p-step-panel>

        <p-step-panel [value]="3">
          <ng-template #content let-activateCallback="activateCallback">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- Opción tarjeta -->
              <label
                class="flex items-center gap-3 p-4 border rounded-xl cursor-pointer transition-all duration-200"
                [ngClass]="{
                  'border-blue-500 bg-blue-50 shadow-md':
                    paymentMethod === 'card',
                  'hover:border-blue-400': paymentMethod !== 'card'
                }"
              >
                <p-radiobutton
                  name="payment"
                  value="card"
                  [(ngModel)]="paymentMethod"
                  inputId="card"
                />
                <i class="pi pi-credit-card text-2xl text-blue-600"></i>
                <span class="font-medium text-gray-800">
                  Tarjeta de crédito/débito
                </span>
              </label>

              <!-- Opción efectivo -->
              <label
                class="flex items-center gap-3 p-4 border rounded-xl cursor-pointer transition-all duration-200"
                [ngClass]="{
                  'border-green-500 bg-green-50 shadow-md':
                    paymentMethod === 'cash',
                  'hover:border-green-400': paymentMethod !== 'cash'
                }"
              >
                <p-radiobutton
                  name="payment"
                  value="cash"
                  [(ngModel)]="paymentMethod"
                  inputId="cash"
                />
                <i class="pi pi-money-bill text-2xl text-green-600"></i>
                <span class="font-medium text-gray-800">
                  Pago en efectivo contra entrega
                </span>
              </label>
            </div>

            <div
              *ngIf="paymentMethod === 'card'"
              class="mt-6 space-y-4 border rounded-xl p-4 bg-gray-50"
            >
              <h3 class="font-semibold text-gray-700 mb-2">
                Datos de la tarjeta
              </h3>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input
                  type="text"
                  pInputText
                  placeholder="Número de tarjeta"
                  [(ngModel)]="card.number"
                  name="cardNumber"
                  class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-400"
                />
                <input
                  type="text"
                  pInputText
                  placeholder="MM/AA"
                  [(ngModel)]="card.expiration"
                  name="expiration"
                  class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-400"
                />
                <input
                  type="text"
                  pInputText
                  placeholder="CVV"
                  [(ngModel)]="card.cvv"
                  name="cvv"
                  class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-400"
                />
                <input
                  type="text"
                  pInputText
                  placeholder="Nombre del titular"
                  [(ngModel)]="card.holder"
                  name="holder"
                  class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-400"
                />
                <input
                  type="text"
                  pInputText
                  placeholder="Documento (DNI)"
                  [(ngModel)]="card.doc"
                  name="doc"
                  class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-400"
                />
              </div>
            </div>
            <div class="flex pt-6 justify-between">
              <p-button
                label="Volver"
                severity="secondary"
                icon="pi pi-arrow-left"
                (onClick)="activateCallback(2)"
              />
              <p-button
                label="Confirmar y Pagar"
                severity="success"
                icon="pi pi-check-circle"
                (onClick)="pay()"
              />
            </div>
          </ng-template>
        </p-step-panel>
      </p-step-panels>
    </p-stepper>
  </div>

  <!-- Columna derecha: Resumen -->
  <div class="bg-white p-6 rounded-2xl shadow-lg sticky top-6 h-fit space-y-4">
    <h2 class="text-2xl font-bold text-gray-800">Resumen del Pedido</h2>

    <div
      *ngFor="let item of items"
      class="flex justify-between py-2 border-b border-gray-200 text-gray-700"
    >
      <div>{{ item.name }} x{{ item.quantity }}</div>
      <div>S/{{ item.price * item.quantity | number : "1.2-2" }}</div>
    </div>

    <div class="flex justify-between text-gray-600">
      <span>Subtotal</span>
      <span>S/{{ total / 1.18 | number : "1.2-2" }}</span>
    </div>
    <div class="flex justify-between text-gray-600">
      <span>IGV (18%)</span>
      <span>S/{{ (total * 0.18) / 1.18 | number : "1.2-2" }}</span>
    </div>
    <div
      class="flex justify-between font-bold text-gray-900 text-lg border-t border-gray-300 pt-3"
    >
      <span>Total</span>
      <span>S/{{ total | number : "1.2-2" }}</span>
    </div>
  </div>
</div>
