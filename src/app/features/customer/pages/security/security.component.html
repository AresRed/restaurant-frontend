<section class="mb-8">
  <h3 class="text-xl font-semibold text-gray-700 mb-4">
    {{ currentUser?.provider === "LOCAL" || hasPassword() ? "Cambiar contraseña" : "Crear contraseña local" }}
  </h3>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div *ngIf="hasPassword()">
      <label class="block text-gray-600 mb-1">Contraseña actual</label>
      <p-password
        type="password"
        [toggleMask]="true"
        styleClass="w-full"
        inputStyleClass="w-full"
        [(ngModel)]="passwords.currentPassword"
        placeholder="Escribe tu contraseña actual"
      />
    </div>

    <div>
      <label class="block text-gray-600 mb-1">Nueva contraseña</label>
      <p-password
        type="password"
        [toggleMask]="true"
        [(ngModel)]="passwords.newPassword"
        styleClass="w-full"
        inputStyleClass="w-full"
        placeholder="Escribe tu nueva contraseña"
      />
    </div>

    <div>
      <label class="block text-gray-600 mb-1">Confirmar nueva contraseña</label>
      <p-password
        type="password"
        [(ngModel)]="passwords.confirmPassword"
        [toggleMask]="true"
        styleClass="w-full"
        inputStyleClass="w-full"
        placeholder="Confirma tu nueva contraseña"
      />
    </div>
  </div>

  <div class="mt-4 flex justify-end">
    <button
      pButton
      type="button"
      label="{{ hasPassword() ? 'Actualizar contraseña' : 'Crear contraseña' }}"
      class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-6 py-2 rounded-md"
      (click)="changePassword()"
    ></button>
  </div>
</section>

<section class="mt-10">
  <h3 class="text-xl font-semibold text-gray-700 mb-4">Sesiones activas</h3>

  <p-table [value]="sessions" responsiveLayout="scroll" class="p-datatable-striped">
    <ng-template pTemplate="header">
      <tr>
        <th>IP / Agente</th>
        <th>Creación</th>
        <th>Expiración</th>
        <th>Acciones</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-session>
      <tr>
        <td>{{ session.ipAddress }} - {{ session.userAgent }}</td>
        <td>{{ session.createdAt | date: 'short' }}</td>
        <td>{{ session.expiryDate | date: 'short' }}</td>
        <td class="flex gap-2">
          <button
            pButton
            type="button"
            label="Cerrar"
            icon="pi pi-sign-out"
            class="p-button-danger p-button-sm"
            (click)="logoutOtherSession(session.sessionId)"
          ></button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <div class="mt-4">
    <button
      pButton
      type="button"
      label="Cerrar sesión actual"
      class="bg-red-600 hover:bg-red-700 text-white font-bold px-6 py-2 rounded-md"
      (click)="logoutCurrentSession()"
    ></button>
  </div>
</section>
