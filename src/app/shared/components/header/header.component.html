<header class="bg-neutral-900 shadow-md sticky z-11">
  <div class="max-w-7xl mx-auto">
    <div class="flex justify-between items-center h-16">
      <!-- Logo -->
      <div class="flex items-center space-x-3 w-80">
        <img
          src="logoF.png"
          alt="Logo"
          class="h-11 w-11 rounded-full shadow-md"
        />
      </div>

      <!-- Desktop nav -->
      <nav class="hidden md:flex space-x-8 text-gray-300 font-medium">
        <a
          routerLink="/home"
          routerLinkActive="text-rojo-principal "
          class="hover:text-rojo-principal transition duration-300 font-[tipo6] text-xl uppercase"
          >Inicio</a
        >
        <a
          routerLink="/menu"
          routerLinkActive="text-rojo-principal "
          class="hover:text-rojo-principal transition duration-300 font-[tipo6] text-xl uppercase"
          >Menú</a
        >
        <a
          routerLink="/reservations"
          routerLinkActive="text-rojo-principal "
          class="hover:text-rojo-principal transition duration-300 font-[tipo6] text-xl uppercase"
          >Reservas</a
        >
        <a
          routerLink="/contact"
          routerLinkActive="text-rojo-principal "
          class="hover:text-rojo-principal transition duration-300 font-[tipo6] text-xl uppercase"
          >Contacto</a
        >
      </nav>

      <!-- Desktop user section -->
      <div
        class="hidden md:flex items-center space-x-2 font-[tipo6] text-xl font-medium"
      >
        <ng-container
          *ngIf="currentUser$ | async as currentUser; else guestButtons"
        >
          <div class="flex items-center space-x-2">
            <span class="font-medium transition text-white">
              {{ currentUser.username || currentUser.email }}
            </span>

            <!-- Avatar -->
            <p-avatar
              *ngIf="currentUser.profileImageUrl; else defaultAvatar"
              [image]="currentUser.profileImageUrl"
              shape="circle"
              styleClass="cursor-pointer"
              (click)="menu.toggle($event)"
            ></p-avatar>

            <ng-template #defaultAvatar>
              <p-avatar
                icon="pi pi-user"
                shape="circle"
                styleClass="bg-blue-500 text-white cursor-pointer"
                (click)="menu.toggle($event)"
              ></p-avatar>
            </ng-template>
          </div>

          <p-menu
            #menu
            [model]="itemsUserMenu"
            [popup]="true"
            appendTo="body"
            styleClass="!bg-rojo-fondo-claro"
          />
        </ng-container>

        <!-- Guest buttons -->
        <ng-template #guestButtons>
          <p-button
            icon="pi pi-shopping-cart"
            variant="text"
            [rounded]="true"
            severity="danger"
            (onClick)="openCart()"
          />
          <p-button
            label="INICIAR SESIÓN"
            (onClick)="openLogin()"
            icon="pi pi-sign-in"
            severity="danger"
            variant="text"
          />
          <p-button
            label="REGISTRARSE"
            (onClick)="openSignup()"
            icon="pi pi-user-plus"
            severity="secondary"
          />
        </ng-template>
      </div>

      <!-- Mobile icons -->
      <div class="flex items-center space-x-2 md:hidden">
        <p-button
          icon="pi pi-shopping-cart"
          variant="text"
          [rounded]="true"
          severity="danger"
          (onClick)="openCart()"
        />
        <p-button
          icon="pi pi-bars"
          severity="secondary"
          (onClick)="isMenuOpen = !isMenuOpen"
        />
      </div>
    </div>
  </div>

  <!-- Mobile menu -->
  <div
    *ngIf="isMenuOpen"
    class="md:hidden bg-gray-800 border-t border-gray-700 shadow-md"
  >
    <nav class="flex flex-col p-4 space-y-4 text-gray-300 font-medium">
      <a
        routerLink="/home"
        routerLinkActive="text-blue-400"
        class="hover:text-blue-400 transition"
        >Inicio</a
      >
      <a
        routerLink="/menu"
        routerLinkActive="text-blue-400"
        class="hover:text-blue-400 transition"
        >Menú</a
      >
      <a
        routerLink="/reservations"
        routerLinkActive="text-blue-400"
        class="hover:text-blue-400 transition"
        >Reservas</a
      >
      <a
        routerLink="/contact"
        routerLinkActive="text-blue-400"
        class="hover:text-blue-400 transition"
        >Contacto</a
      >

      <hr class="border-gray-600" />

      <div class="flex flex-col space-y-2">
        <ng-container
          *ngIf="currentUser$ | async as currentUser; else mobileGuest"
        >
          <div
            class="flex items-center space-x-2 px-2 py-2 bg-gray-700 rounded"
          >
            <!-- Mobile avatar -->
            <p-avatar
              *ngIf="currentUser.profileImageUrl; else defaultMobileAvatar"
              [image]="currentUser.profileImageUrl"
              shape="circle"
            ></p-avatar>

            <ng-template #defaultMobileAvatar>
              <p-avatar
                icon="pi pi-user"
                shape="circle"
                styleClass="bg-blue-500 text-white"
              ></p-avatar>
            </ng-template>

            <span>{{ currentUser.username || currentUser.email }}</span>
          </div>

          <button
            class="w-full text-left px-3 py-2 text-gray-300 hover:bg-gray-600 rounded"
            (click)="goToProfile()"
          >
            Perfil
          </button>
          <button
            class="w-full text-left px-3 py-2 text-gray-300 hover:bg-gray-600 rounded"
            (click)="goToOrders()"
          >
            Mis compras
          </button>
          <button
            class="w-full text-left px-3 py-2 text-gray-300 hover:bg-gray-600 rounded"
            (click)="goToReservations()"
          >
            Mis reservas
          </button>
          <button
            class="w-full text-left px-3 py-2 text-gray-300 hover:bg-gray-600 rounded"
            (click)="logout()"
          >
            Cerrar sesión
          </button>
        </ng-container>

        <ng-template #mobileGuest>
          <p-button
            label="Iniciar Sesión"
            (onClick)="openLogin()"
            icon="pi pi-sign-in"
            severity="secondary"
            styleClass="w-full"
          />
          <p-button
            label="Registrarse"
            (onClick)="openSignup()"
            severity="secondary"
            styleClass="w-full"
          />
        </ng-template>
      </div>
    </nav>
  </div>

  <app-login-drawer></app-login-drawer>
  <app-cart-drawer></app-cart-drawer>
</header>
